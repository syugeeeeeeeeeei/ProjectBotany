できるだけ構造は簡潔にフラットにかつ必要十分にして、ソースコードとして実装する際はクリーンで構造化された定義を心がけて可読性を高める。

---

# 📊 データ構造要件

このセクションでは、ゲームの内部で状態を管理するためのデータ構造を、「パラメーター名: 型」と「説明」の形式で定義します。

---

### 📚 基本的な型定義

ゲーム全体で共通して使用される、基本的な選択肢（ユニオン型）を定義します。

#### プレイヤーの種類 (`PlayerType`)

- `'native'`: 在来種サイドのプレイヤーを示します。
- `'alien'`: 外来種サイドのプレイヤーを示します。

#### マスの状態 (`CellType`)

- `'native_area'`: 在来種が支配している濃い緑色のマスです。
- `'alien_area'`: 外来種サイドが支配している赤色のマスです（トークンがある場所も含む）。
- `'bare_ground_area'`: 何も生えていない灰色のマス（裸地マス）です。
- `'pioneer_vegetation_area'`: 在来種への回復を待っている薄緑色のマス（先駆植生マス）です。

#### カード効果の形状 (`ShapeType`)

- `'single'`: 単一のマスを対象とします。
- `'cross'`: 指定マスを中心とした十字形の範囲を対象とします。
- `'straight'`: 指定マスから一方向への直線範囲を対象とします。
- `'range'`: 指定マスを中心とした正方形の範囲を対象とします。

#### カード効果の方向 (`DirectionType`)

- `'up', 'down', 'left', 'right'`: 上下左右のいずれか一方向を示します。
- `'vertical'`: 上下両方向を示します。
- `'horizon'`: 左右両方向を示します。

---

#### 🎮 ゲーム全体の状態 (`GameState`)

ゲーム全体の現在の状況を把握するための、最も上位のデータ構造です。

- `currentRound: number`
  現在のラウンド数を示す数値です。
- `maximumRounds: number`
  ゲームが終了する総ラウンド数を示す数値です（例：8 ラウンド）。
- `activePlayerId: 'native' | 'alien'`
  現在手番のプレイヤー（在来種か外来種か）を識別するための値です。
- `gameField: FieldState`
  ゲーム盤面であるフィールドの、すべてのマスの状態を記録した「フィールドの状態」への参照です。
- `playerStates: { [key in 'native' | 'alien']: PlayerState }`
  各プレイヤーがそれぞれ持っている情報をまとめた「プレイヤーの状態」への参照です。
- `currentPhase: 'round_start' | 'alien_turn' | 'native_turn' | 'round_end'`
  今、ラウンドの中のどのフェーズにいるかを記録します。
- `isGameOver: boolean`
  ゲームが終了したかどうかを示します。
- `winningPlayerId: 'native' | 'alien' | null`
  勝利プレイヤーの ID です。引き分けの場合は「null」。
- `activeAlienInstances: { [instanceId: string]: ActiveAlienInstance }`
  フィールドに導入されて活動している、ひとつひとつの外来種トークンの詳しい情報を管理する入れ物です。

---

#### 🗺️ フィールドの状態 (`FieldState` と `CellState`)

ゲーム盤面（フィールド）全体の情報と、その中の個々のマスの情報を管理します。

##### フィールド全体のデータ (`FieldState`)

- `width: number`
  フィールドが横に何マスあるかを示す数値です。
- `height: number`
  フィールドが縦に何マスあるかを示す数値です。
- `cells: CellState[][]`
  フィールド上のすべてのマス情報を、縦と横の並び（二次元配列）で管理します。

##### 個々のマスの状態 (`CellState`)

マスは、その種類（`cellType`）に応じて保持するデータが異なります。

- **マスの基本情報 (`CellStateBase`)** - 全てのマスが共通して持つ情報です。

  - `x: number`
    マスの横方向の位置を示す数値です。
  - `y: number`
    マスの縦方向の位置を示す数値です。
  - `alienTokenId?: string | null`
    このマス上に外来種トークンが存在する場合、そのインスタンス ID を保持します。

- **在来種マス (`NativeAreaCell`)**

  - `cellType: 'native_area'`
    マスの種類が「在来種マス」であることを示します。
  - `ownerId: 'native'`

- **裸地マス (`BareGroundAreaCell`)**

  - `cellType: 'bare_ground_area'`
    マスの種類が「裸地マス」であることを示します。
  - `ownerId: null`

- **先駆植生マス (`PioneerVegetationAreaCell`)**

  - `cellType: 'pioneer_vegetation_area'`
    マスの種類が「先駆植生マス」であることを示します。
  - `ownerId: null`
  - `createdRound: number`
    このマスが先駆植生状態になったラウンド数です。

- **外来種マス (`AlienAreaCell`)**
  - `cellType: 'alien_area'`
    マスの種類が「外来種マス」であることを示します。
  - `ownerId: 'alien'`
  - `dominantAlienInstanceId: string`
    このマスを現在支配している（所有侵略マスとしている）外来種インスタンスの ID です。

---

#### 🌿 アクティブな外来種インスタンスの状態 (`ActiveAlienInstance`)

フィールドに実際に導入された、ひとつひとつの外来種トークンに関する情報を管理します。

- `instanceId: string`
  その外来種トークンの固有識別子です。
- `spawnedRound: number`
  このインスタンスがフィールドに導入されたラウンド数です。同コストの外来種間の優先度判定に使用します。
- `cardDefinitionId: string`
  元となったカード定義 ID です。
- `currentX: number`
  現在置かれている X 座標です。
- `currentY: number`
  現在置かれている Y 座標です。
- `currentInvasionPower: number`
  現在の侵略力です。「成長」によって変化します。
- `currentInvasionShape: 'single' | 'cross' | 'straight' | 'range'`
  現在の侵略形です。「成長」によって変化します。
- `currentGrowthStage: number`
  現在の成長段階を示す数値です。
- `roundsSinceSpawn: number`
  導入されてから何ラウンド経過したかを示す数値です。

---

#### 🃏 カードの定義 (`CardDefinition`)

- `id: string`
- `name: string`
- `description: string`
- `cost: number`
- `deckCount: number`
- `imagePath: string`
- `targeting: object`
  - `power: number`
  - `shape: 'single' | 'cross' | 'straight' | 'range'`
  - `direction?: DirectionType`
- `usageLimit?: number | null`
- `cooldownRounds?: number | null`

##### 外来種カードに固有の情報 (`cardType: 'alien'`)

- `cardType: 'alien'`
- `canGrow?: boolean`
- `growthConditions?: GrowthCondition[]`
- `growthEffects?: GrowthEffect[]`

##### 駆除カードに固有の情報 (`cardType: 'eradication'`)

- `cardType: 'eradication'`
- `targeting: object | { target: 'species' }`
- `postRemovalState: 'bare_ground_area' | 'pioneer_vegetation_area'`

##### 回復カードに固有の情報 (`cardType: 'recovery'`)

- `cardType: 'recovery'`
- `postRecoveryState: 'native_area' | 'pioneer_vegetation_area'`

---

#### 👤 プレイヤーの状態 (`PlayerState`)

- `playerId: 'native' | 'alien'`
- `playerName: string`
- `facingFactor: 1 | -1`
- `initialEnvironment: number`
- `currentEnvironment: number`
- `maxEnvironment: number`
- `cardLibrary: CardInstance[]`
  手札にある全てのカードインスタンスのリストです。
- `cooldownActiveCards: { cardId: string, roundsRemaining: number }[]`
  クールタイム中のカードと、その残りラウンド数を記録した一覧です。
- `limitedCardsUsedCount: { [cardId: string]: number }`
