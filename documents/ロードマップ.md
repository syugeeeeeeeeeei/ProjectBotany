# 🗺️ 詳細開発ロードマップ: プロジェクト・ボタニー

## Phase 0: 準備フェーズ (完了済み)

-   **要件定義**: ゲームの目的、ルール、カード仕様、データ構造のドキュメント化
-   **技術選定**: React, TypeScript, Vite, Dockerなどの主要技術を決定
-   **環境構築**: DockerとViteによる統一開発環境をセットアップ

---

## Phase 1: 基盤構築フェーズ

-   **目的**: コーディングを開始できる状態にする
-   **タスク**:
    1.  **依存ライブラリの導入**:
        -   `yarn add @react-three/fiber @react-three/drei three` (3D描画)
        -   `yarn add styled-components` (スタイリング)
        -   `yarn add -D vitest @vitest/ui @testing-library/react` (テスト)
    2.  **型定義の実装**:
        -   `データ要件.md`に基づき、`src/types/data.ts`に`GameState`, `CardDefinition`等のTypeScript `interface` を作成する。
    3.  **テスト環境のセットアップ**:
        -   `vite.config.ts`に`vitest`の設定を追記し、Reactコンポーネントのテストを実行可能にする。
        -   `src/setupTests.ts`を作成する。
    4.  **主要コンポーネントの雛形作成**:
        -   `GameBoard.tsx`: フィールド全体を描画するコンポーネント。
        -   `GameCell.tsx`: 個々のマスを描画するコンポーネント。
        -   `Card.tsx`: カード1枚を描画するコンポーネント。
        -   `PlayerHand.tsx`: プレイヤーが使用できるカード一覧を表示するコンポーネント。
        -   `GameUI.tsx`: ターン表示やリソース表示など、ゲーム全体のUIを管理するコンポーネント。
    5.  **エントリーポイントの更新**:
        -   `App.tsx`を更新し、作成した雛形コンポーネントを仮のデータで表示する。

---

## Phase 2: コア機能実装フェーズ

-   **目的**: ゲームの基本的なルールがコード上で動作する状態にする
-   **タスク**:
    1.  **グローバル状態管理の導入**:
        -   ゲーム全体の状態(`GameState`)を管理するため、React Context API または Zustandのような状態管理ライブラリを導入し、セットアップする。
    2.  **ゲーム進行ロジックの実装**:
        -   ターン進行、プレイヤー交代、フェーズ移行（エンバイロメント→召喚→活性）を制御する関数群を作成する。
        -   エンバイロメントが毎ターン、最大値と共に回復するロジックを実装する。
    3.  **プレイヤーアクションの実装**:
        -   **外来種カード使用**: カードコストを消費し、フィールドに`ActiveAlienInstance`を生成、対応するマスの`cellType`を`alien_core`に変更するロジックを実装する。
        -   **駆除カード使用**: カードコストを消費し、指定したマスの`cellType`を`empty_area`などに変更するロジックを実装する。
        -   **回復カード使用**: カードコストを消費し、指定したマスの`cellType`を`native_area`などに変更するロジックを実装する。
    4.  **活性フェーズの自動処理ロジック**:
        -   **外来種の拡散**: 全ての`ActiveAlienInstance`をループし、侵略力と侵略形に基づいて周囲のマスを`alien_invasion_area`に変更する。侵略優先度に基づく上書き処理も実装する。
        -   **在来種の自動回復**: 全てのマスをループし、`empty_area`→`recovery_pending_area`→`native_area`と状態が遷移するロジックを実装する。
        -   **外来種の成長**: `ActiveAlienInstance`の`turnsSinceLastAction`などを条件に、能力が強化されるロジックを実装する。
        -   **支配マスゼロによる除去**: 自身の支配マスが0になった外来種をフィールドから除去するロジックを実装する。
    5.  **単体テストの作成**:
        -   上記で実装した各ロジック（状態変更関数）に対して、`vitest`で単体テストを作成し、意図通りに動作することを保証する。

---

## Phase 3: UI/UX強化フェーズ

-   **目的**: ゲーム体験を向上させるためのビジュアルと操作性を実装する
-   **タスク**:
    1.  **3Dビジュアライゼーション**:
        -   `GameBoard`コンポーネントを`@react-three/fiber`の`<Canvas>`に置き換え、平面のグリッドを3Dオブジェクトで表現する。
        -   `GameCell`の状態（色、高さなど）を`CellState`と連動させる。
        -   `Card`コンポーネントを3D空間内に表示する。
    2.  **インタラクションの実装**:
        -   カードのドラッグ＆ドロップ操作、またはクリックによるカード選択機能を実装する。
        -   フィールドのマスをクリックして、カード効果の対象を選択できるようにする。
        -   カメラコントロール（ズーム、パンなど）を`@react-three/drei`を用いて実装する。
    3.  **ビジュアルエフェクトとフィードバック**:
        -   カード使用時、マス侵略時、駆除時などにパーティクルや発光などの簡易的なエフェクトを追加する。
        -   `GameUI`コンポーネントを本格的に実装し、現在のターン、プレイヤー、エンバイロメント数などを常に表示する。
    4.  **全体的なスタイリング**:
        -   `styled-components`を用いて、UI全体の色、フォント、レイアウトをデザイン要件に合わせて調整する。

---

## Phase 4: 仕上げフェーズ

-   **目的**: 公開可能な品質に仕上げる
-   **タスク**:
    1.  **静的データの外部化**:
        -   `CardDefinition`などのマスターデータを、TypeScriptファイル内からJSONファイルなどに分離し、管理を容易にする。
    2.  **ゲームバランス調整**:
        -   複数回のプレイテストを実施し、カードのコストや効果、最大ターン数などのパラメータを調整する。
        -   ゲームログ(`GameLog`)をコンソールに出力し、ゲーム展開の分析を容易にする。
    3.  **最終デバッグと最適化**:
        -   発見されたバグを修正する。
        -   特に3D描画のパフォーマンスを調査し、不要な再レンダリングなどを抑制して最適化を行う。
    4.  **本番デプロイ準備**:
        -   `yarn build`コマンドで本番用の静的ファイルを生成する。
        -   `docker-compose.prod.yml`と`serve`を利用して、本番環境での動作をシミュレートし、最終確認を行う。