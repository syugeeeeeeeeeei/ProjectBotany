できるだけ構造は簡潔にフラットにかつ必要十分にして、ソースコードとして実装する際はクリーンで構造化された定義を心がけて可読性を高める。

---

# 📊 データ構造要件

このセクションでは、ゲームの内部で状態を管理するためのデータ構造を、「パラメーター名: 型」と「説明」の形式で定義します。

---

### 📚 基本的な型定義

ゲーム全体で共通して使用される、基本的な選択肢（ユニオン型）を定義します。

#### プレイヤーの種類 (`PlayerType`)

* `'native'`: 在来種サイドのプレイヤーを示します。 
* `'alien'`: 外来種サイドのプレイヤーを示します。 

#### マスの状態 (`CellType`)

* `'native_area'`: 在来種が支配している緑色のマスです。 
* `'alien_core'`: 外来種のコマが置かれている中心となる赤色のマスです。 
* `'alien_invasion_area'`: 侵略マス。外来種の侵略効果によって赤色に変化したマスです。 
* `'empty_area'`: 何も生えていない灰色のマスです。 
* `'recovery_pending_area'`: 再生を待っている黄色のマスです。 

#### カード効果の形状 (`ShapeType`)

* `'single'`: 単一のマスを対象とします。 
* `'cross'`: 指定マスを中心とした十字形の範囲を対象とします。 
* `'straight'`: 指定マスから一方向への直線範囲を対象とします。 
* `'range'`: 指定マスを中心とした正方形の範囲を対象とします。 

#### カード効果の方向 (`DirectionType`)

* `'up', 'down', 'left', 'right'`: 上下左右のいずれか一方向を示します。 
* `'vertical'`: 上下両方向を示します。 
* `'horizon'`: 左右両方向を示します。 

---

#### 🎮 ゲーム全体の状態 (`GameState`)

ゲーム全体の現在の状況を把握するための、最も上位のデータ構造です。

* `currentTurn: number`
    現在のターン数を示す数値です。
* `maximumTurns: number`
    ゲームが終了する総ターン数を示す数値です（例：8ターン）。この数に達すると勝敗が決まります。
* `activePlayerId: 'native' | 'alien'`
    現在手番のプレイヤー（在来種か外来種か）を識別するための値です。
* `gameField: FieldState`
    ゲーム盤面であるフィールドの、すべてのマスの状態を記録した「フィールドの状態」という入れ物への参照です。
* `playerStates: { [key in 'native' | 'alien']: PlayerState }`
    各プレイヤーがそれぞれ持っている情報をまとめた「プレイヤーの状態」という入れ物への参照です。プレイヤーの種類（`'native'`, `'alien'`）をキーとして、各プレイヤーの情報を管理します。
* `currentPhase: 'environment_phase' | 'summon_phase' | 'activation_phase'`
    今、ターンの中のどの段階にいるかを記録します。
* `isGameOver: boolean`
    ゲームがもう終わったかどうかを真偽値で示します。
* `winningPlayerId: 'native' | 'alien' | null`
    ゲームが終わった場合に、どちらが勝ったのかを識別するための値です。引き分けの場合は「null」として記録されます。
* `activeAlienInstances: { [instanceId: string]: ActiveAlienInstance }`
    フィールドに配置されて活動している、ひとつひとつの外来種の詳しい情報を、そのインスタンス固有の識別子をキーとしてまとめた入れ物です。

---

#### 🗺️ フィールドの状態 (`FieldState` と `CellState`)

ゲーム盤面（フィールド）全体の情報と、その中の個々のマスの情報を管理します。

##### フィールド全体のデータ (`FieldState`)

* `width: number`
    フィールドが横に何マスあるかを示す数値です。
* `height: number`
    フィールドが縦に何マスあるかを示す数値です。
* `cells: CellState[][]`
    フィールド上のすべてのマスについて、そのマスの詳しい情報（個々のマスの状態）を、縦と横の並び（二次元配列）で管理します。

##### 個々のマスの状態 (`CellState`)

マスは、その種類（`cellType`）に応じて保持するデータが異なります。

* **マスの基本情報 (`CellStateBase`)** - 全てのマスが共通して持つ情報です。
    * `x: number`
        マスの横方向の位置を示す数値です。
    * `y: number`
        マスの縦方向の位置を示す数値です。

* **在来種マス (`NativeAreaCell`)** - 在来種が支配している緑色のマスです。
    * `cellType: 'native_area'`
        マスの種類が「在来種マス」であることを示します。
    * `ownerId: 'native'`
        このマスを在来種プレイヤーが所有していることを示します。

* **空マス (`EmptyAreaCell`)** - 何も生えていない灰色のマスです。
    * `cellType: 'empty_area'`
        マスの種類が「空マス」であることを示します。
    * `ownerId: null`
        このマスは誰にも所有されていません。

* **再生待機マス (`RecoveryPendingAreaCell`)** - 空マスから変化した、再生を待っている黄色のマスです。
    * `cellType: 'recovery_pending_area'`
        マスの種類が「再生待機マス」であることを示します。
    * `ownerId: null`
        このマスは誰にも所有されていません。
    * `recoveryPendingTurn: number`
        このマスが再生待機状態になったターン数です。

* **外来種（コア）マス (`AlienCoreCell`)** - 外来種のコマが置かれている中心マスです。
    * `cellType: 'alien_core'`
        マスの種類が「外来種（コア）マス」であることを示します。
    * `ownerId: 'alien'`
        このマスを外来種プレイヤーが所有していることを示します。
    * `alienInstanceId: string`
        このマスに存在する外来種インスタンスのIDです。

* **侵略マス (`AlienInvasionAreaCell`)** - 外来種の侵略効果によって赤色に変化したマスです。
    * `cellType: 'alien_invasion_area'`
        マスの種類が「侵略マス」であることを示します。
    * `ownerId: 'alien'`
        このマスを外来種プレイヤーが所有していることを示します。
    * `dominantAlienInstanceId: string`
        このマスを現在支配している外来種インスタンスのIDです。

---

#### 🌿 アクティブな外来種インスタンスの状態 (`ActiveAlienInstance`)

フィールドに実際に召喚されて置かれている、ひとつひとつの外来種（コマ）に関する、ゲーム中に変化する情報を管理します。

* `instanceId: string`
    フィールドに置かれるたびに新しく発行される、その外来種コマの固有の識別文字列です。
* `spawnedTurn: number`
    このインスタンスがフィールドに配置されたターン数です。同コストの外来種間の優先度判定に使用します。
* `cardDefinitionId: string`
    この外来種コマが、元々どの「カードの定義データ」から生まれたのかを示すIDです。
* `currentX: number`
    その外来種コマがフィールドのどのマス（X座標）に現在置かれているかを示す数値です。
* `currentY: number`
    その外来種コマがフィールドのどのマス（Y座標）に現在置かれているかを示す数値です。
* `currentInvasionPower: number`
    この外来種コマが、今現在どれだけの侵略力を持っているかを示す数値です。「成長」によって変化します。
* `currentInvasionShape: 'single' | 'cross' | 'straight' | 'range'`
    この外来種コマが、今現在どのようなパターンで侵略するかを示す文字列です。「成長」によって変化します。
* `currentGrowthStage: number`
    この外来種コマが今、成長プロセスのどの段階にいるかを示す数値です。
* `turnsSinceLastAction: number`
    この外来種コマが配置、または最後に移動してから何ターン経過したかを示す数値です。「成長」の条件判定に使われます。

---

#### 🃏 カードの定義 (`CardDefinition`)

ゲームに登場するすべてのカードの、ゲーム開始前から決まっている「静的な情報」をまとめた入れ物です。

* `id: string`
    そのカードの種類を識別するための固有の文字列です。
* `name: string`
    カードの表示名です。
* `description: string`
    そのカードの効果や特徴を説明するテキストです。
* `cost: number`
    そのカードを使うために必要なエンバイロメントの量を示す数値です。
* `deckCount: number`
    将来のデッキ構築用：1デッキに入れられる最大枚数です。
* `imagePath: string`
    そのカードの画像ファイルがどこにあるかを示す文字列です。
* `targeting: object`
    カード効果の基本的な範囲を定義するオブジェクトです。
    * `power: number` - 効果の威力・範囲の大きさを示します。
    * `shape: 'single' | 'cross' | 'straight' | 'range'` - 効果の形状を示します。
    * `direction?: 'up' | 'down' | 'left' | 'right' | 'vertical' | 'horizon'` - 効果の方向（主に`'straight'`形状で使用）を示します。
* `usageLimit?: number | null`
    そのカードが1ゲーム中に使用できる最大回数です。`null`の場合は無制限です。
* `cooldownTurns?: number | null`
    使用後に再度使用可能になるまでのターン数です。`null`の場合はクールタイムなしです。

##### 外来種カードに固有の情報 (`cardType: 'alien'`)

* `cardType: 'alien'`
    カードの種類が「外来種」であることを示します。
* `canGrow?: boolean`
    このカードが「成長」の特性を持つかどうかを示す真偽値です。
* `growthConditions?: GrowthCondition[]`
    成長条件のリストです。
* `growthEffects?: GrowthEffect[]`
    成長効果のリストです。

##### 駆除カードに固有の情報 (`cardType: 'eradication'`)

* `cardType: 'eradication'`
    カードの種類が「駆除」であることを示します。
* `targeting: object | { target: 'species' }`
    駆除カードの効果範囲です。基本の形状指定に加え、例外的に特定の外来種全体を対象とする`'species'`を指定できます。
* `postRemovalState: 'empty_area' | 'recovery_pending_area'`
    駆除されたマスがどの状態になるかを示します。

##### 回復カードに固有の情報 (`cardType: 'recovery'`)

* `cardType: 'recovery'`
    カードの種類が「回復」であることを示します。
* `postRecoveryState: 'native_area' | 'recovery_pending_area'`
    回復されたマスがどの状態になるかを示します。

---

#### 👤 プレイヤーの状態 (`PlayerState`)

各プレイヤーがそれぞれ持っている、ゲーム中に変化する情報を管理します。

* `playerId: 'native' | 'alien'`
    そのプレイヤーがどちらのサイドかを示す識別子です。
* `playerName: string`
    表示用の名前です。
* `facingFactor: 1 | -1`
    プレイヤーの向きを示す係数です。対面プレイ時の方向計算に用います（奥側プレイヤーは-1）。
* `initialEnvironment: number`
    ゲーム開始時の初期エンバイロメント量です（ハンデ調整用）。
* `currentEnvironment: number`
    そのプレイヤーが今使えるエンバイロメントの量を示す数値です。
* `maxEnvironment: number`
    そのプレイヤーが保有できるエンバイロメントの最大量です。
* `cardLibrary: CardInstance[]`
    そのプレイヤーがゲーム中に使用できる全てのカードのインスタンスのリストです。
* `cooldownActiveCards: { cardId: string, turnsRemaining: number }[]`
    クールタイム中のカードと、その残りターン数を記録した一覧です。
* `limitedCardsUsedCount: { [cardId: string]: number }`
    使用回数制限のあるカードについて、どのカードを何回使ったかを記録したマップです。