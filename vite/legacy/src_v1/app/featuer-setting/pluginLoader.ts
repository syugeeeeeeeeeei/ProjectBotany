import { ENABLED_FEATURES, FeatureKey } from "./config";
import { FEATURE_MANIFEST } from "./manifest";

/**
 * ğŸŒ¿ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼
 * 
 * ã€å‹•æ©Ÿã€‘
 * `ENABLED_FEATURES` ã®è¨­å®šã«åŸºã¥ãã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•æ™‚ã«å¿…è¦ãªæ©Ÿèƒ½ã®ã¿ã‚’é¸æŠçš„ã«åˆæœŸåŒ–ã™ã‚‹ãŸã‚ã§ã™ã€‚
 * ä¸­å¤®é›†æ¨©çš„ãªåˆæœŸåŒ–ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒã¤ã“ã¨ã§ã€å„æ©Ÿèƒ½ãŒå€‹åˆ¥ã«èµ·å‹•ãƒ—ãƒ­ã‚»ã‚¹ã«ä»‹å…¥ã™ã‚‹ã®ã‚’é˜²ãã€
 * ç§©åºã‚ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã‚’å®Ÿç¾ã—ã¾ã™ã€‚
 *
 * ã€æ©æµã€‘
 * - ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«æ©Ÿèƒ½ã®ãƒ­ãƒ¼ãƒ‰çŠ¶æ³ï¼ˆLogic-Merge/Logic-Purgeï¼‰ãŒæ˜ç¤ºçš„ã«å‡ºåŠ›ã•ã‚Œã€
 *   ç¾åœ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’å¯è¦–åŒ–ã§ãã¾ã™ã€‚
 * - `Promise.all` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€è¤‡æ•°ã®æ©Ÿèƒ½ã®ç‹¬ç«‹ã—ãŸåˆæœŸåŒ–ã‚’ä¸¦åˆ—ã«è¡Œã„ã€
 *   èµ·å‹•æ™‚é–“ã‚’çŸ­ç¸®ã§ãã¾ã™ã€‚
 *
 * ã€ä½¿ç”¨æ³•ã€‘
 * `main.tsx` ç­‰ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆä»˜è¿‘ã§ `loadPlugins()` ã‚’ä¸€åº¦ã ã‘å‘¼ã³å‡ºã—ã¾ã™ã€‚
 */
export const loadPlugins = async () => {
	console.group("ğŸŒ¿ Project Botany Plugin Loader");

	// è¨­å®šã•ã‚ŒãŸå…¨æ©Ÿèƒ½ã«å¯¾ã—ã¦åˆæœŸåŒ–ã‚¿ã‚¹ã‚¯ã‚’ç”Ÿæˆ
	const tasks = Object.entries(ENABLED_FEATURES).map(async ([key, isEnabled]) => {
		const featureKey = key as FeatureKey;

		if (isEnabled) {
			// æ©Ÿèƒ½ãŒæœ‰åŠ¹ãªå ´åˆã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‹ã‚‰èª­ã¿è¾¼ã¿é–¢æ•°ã‚’å–å¾—ã—ã¦å®Ÿè¡Œ
			// ä¸è¦ãªã‚³ãƒ¼ãƒ‰ã®èª­ã¿è¾¼ã¿ï¼ˆã‚³ãƒ¼ãƒ‰åˆ†å‰²ï¼‰ã¨å‹•çš„ãªç™»éŒ²ã‚’è¡Œã†ãŸã‚ã«å¿…è¦ã§ã™
			const loadFunc = FEATURE_MANIFEST[featureKey];
			if (loadFunc) {
				await loadFunc();
				console.info(`âœ… Logic-Merge: ${featureKey}`);
			}
		} else {
			// æ©Ÿèƒ½ãŒç„¡åŠ¹ãªå ´åˆã¯ãƒ­ã‚°ã®ã¿å‡ºåŠ›
			console.warn(`ğŸš« Logic-Purge: ${featureKey}`);
		}
	});

	// ã™ã¹ã¦ã®åˆæœŸåŒ–ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã™ã‚‹ã®ã‚’å¾…æ©Ÿ
	await Promise.all(tasks);
	console.groupEnd();
};